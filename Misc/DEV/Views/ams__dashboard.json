{"name":"ams::dashboard","category":"view","description":"Gets all patients with active prescriptions for provided meds codes","metaData":"{\r\n    \"parameters\": [\r\n        {\r\n            \"name\": \"medications\",\r\n            \"type\": \"array\",\r\n            \"description\": \"Antimicrobial medication codes\"\r\n        },\r\n        {\r\n            \"name\": \"routes\",\r\n            \"type\": \"array\",\r\n            \"description\": \"Routes of administration\"\r\n        },\r\n{\r\n            \"name\": \"patientIds\",\r\n            \"type\": \"array\",\r\n            \"description\": \"Patient subject ids\"\r\n        }\r\n    ]\r\n}","steps":[{"processorName":"jsonFtlAql","processorData":"-- View: ams::dashboard v1.0.0\r\n-- Template required: OPENeP - Inpatient Prescription\r\n-- Author: Bo≈°tjan Lah (bostjan.lah@better.care)\r\n\r\nSELECT \r\ne/ehr_status/subject/external_ref/id/value as patientId,\r\ne/ehr_id/value as ehrId,  \r\na/description[at0002]/items[at0070]/value/defining_code/code_string as medsCode1, \r\na/description[at0002]/items[at0070]/value/value as medsValue1, \r\na/description[at0002]/items[openEHR-EHR-CLUSTER.medication.v0]/items[openEHR-EHR-CLUSTER.medication.v0]/items[at0132]/value/defining_code/code_string as medsCode2,\r\na/description[at0002]/items[openEHR-EHR-CLUSTER.medication.v0]/items[openEHR-EHR-CLUSTER.medication.v0]/items[at0132]/value/value as medsValue2,\r\na/description[at0002]/items[at0091]/value/defining_code/code_string as routeCode,\r\na/description[at0002]/items[at0091]/value/value as routeValue,\r\na/description[at0002]/items[at0009]/value/value as description,\r\na/description[at0002]/items[at0018]/value/value as indication\r\nFROM EHR e\r\nCONTAINS Composition c[openEHR-EHR-COMPOSITION.prescription.v0]\r\nCONTAINS Instruction i[openEHR-EHR-INSTRUCTION.medication_order.v2]\r\nCONTAINS Activity a[at0001]\r\nWHERE c/name/value = 'Inpatient Prescription'\r\nAND\r\na/description[at0002]/items[at0113]/items[at0012]/value <= current_timestamp()\r\nAND\r\n(NOT EXISTS a/description[at0002]/items[at0113]/items[at0013]/value OR a/description[at0002]/items[at0113]/items[at0013]/value >= current_timestamp())\r\nAND\r\n(a/description[at0002]/items[at0070]/value/defining_code/code_string matches {:medications} \r\nOR \r\ni/activities[at0001]/description[at0002]/items[openEHR-EHR-CLUSTER.medication.v0]/items[openEHR-EHR-CLUSTER.medication.v0]/items[at0132]/value/defining_code/code_string matches {:medications})\r\nAND current_state(a) = 'ACTIVE'\r\n<#if ctx.vars.routes??>\r\nAND\r\na/description[at0002]/items[at0091]/value/defining_code/code_string matches {:routes}\r\n</#if>\r\n<#if ctx.vars.patientIds??>\r\nAND\r\ne/ehr_status/subject/external_ref/id/value matches {:patientIds}\r\n</#if>\r\nfetch 1500"}]}