{"name":"getAllCareplans","category":"view","description":null,"metaData":"{\n    \"parameters\": [\n        {\n            \"name\": \"ehrId\",\n            \"description\": \"\",\n            \"type\": \"string\"\n        }\n    ]\n}","steps":[{"processorName":"jsonAql","processorData":"SELECT a/uid/value as compositionId, a/name as templateId, a/composer/name as composer, a/context/start_time/value as compositionSaved, \na_a/description[at0019]/items[at0002]/value/value as carePlanName, a_a/protocol[at0015]/items[at0016]/value/id as carePlanId, \na_b/description[at0001]/items[at0002]/value as consentName, a_b/ism_transition/careflow_step/value as consentCareFlowStep, \na_b/description[at0001]/items[at0008]/value/value as startDate, a_b/description[at0001]/items[at0009]/value/value as endDate, \na_b/ism_transition/careflow_step/defining_code/code_string as consentCareflowStepCode, a_b/ism_transition/current_state/value as consentCurrentState, \na_b/ism_transition/current_state/code as consentCurrentStateCode, \nb_a/items[at0001]/value/uri/value as multimediaFileUri, \nb_a/items[at0001]/value/alternate_text as multimediaFileName \nFROM EHR e[ehr_id/value=:ehrId] \ncontains COMPOSITION a[openEHR-EHR-COMPOSITION.encounter.v1] \ncontains ( ACTION a_a[openEHR-EHR-ACTION.care_plan.v0] and ACTION a_b[openEHR-EHR-ACTION.informed_consent.v0] or CLUSTER b_a[openEHR-EHR-CLUSTER.multimedia.v0]) \nWHERE a/name/value=\"Care Plan Consent\" \nORDER BY a/context/start_time/value desc"}]}