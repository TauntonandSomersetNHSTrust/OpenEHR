{"name":"Reports::GeneralPatientFormStats","category":"view","description":"Returns completed form data on patient provided","metaData":"{\r\n  \"parameters\": [\r\n      {\r\n          \"name\": \"ehrId\",\r\n          \"type\": \"string\",\r\n          \"description\": \"Ehr id\"\r\n      }\r\n  ]\r\n}","steps":[{"processorName":"js","processorData":"// v1.0.0 - development build\r\n\r\nvar ehrIDReplace = \"<ehrid>\";\r\n\r\nvar highAQL = \"SELECT c/context/start_time/value as high_completed, \" +\r\n\t\"i/data[at0001]/items[at0005]/value/value as assessment_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'Infectious']/items[at0012]/value/value as infecton_infectious_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'Lived Abroad']/items[at0012]/value/value as infecton_abroad_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'Stayed in a hospital outside the country']/items[at0012]/value/value as infecton_hospital_out_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'Stayed in a hospital within the country outside region']/items[at0012]/value/value as infecton_hospital_in_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'Travelled Outside Region']/items[at0012]/value/value as infecton_travelled_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'Been in a household or location with a known case of Carbapenemase Producing Enterobacteriaceae (CPE)']/items[at0012]/value/value as infecton_householdcpe_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'Been colonised or had an infection with CPE bacteria']/items[at0012]/value/value as infecton_colonisedcpe_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[at0009,'MRSA Screening']/items[at0012]/value/value as infecton_mrsa_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Patient Isolation']/items[at0030]/value/value as infecton_isolation_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Specimen Collection']/items[at0030]/value/value as infecton_specimen_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Rectal Swab Collection']/items[at0030]/value/value as infecton_rectal_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[openEHR-EHR-CLUSTER.generic_action.v0,'MRSA Screening']/items[at0030]/value/value as infecton_mrsa2_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Infection Control']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Contact Infection Control']/items[at0030]/value/value as infecton_contact_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[at0009,'Existing Pressure Ulcer']/items[at0012]/value/value as ulcers_existing_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[at0009,'Paraplegia']/items[at0012]/value/value as ulcers_paraplegia_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[at0009,'Peripheral Neuropathy']/items[at0012]/value/value as ulcers_neuropathy_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[at0009,'Mobility']/items[at0012]/value/value as ulcers_mobility_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[openEHR-EHR-CLUSTER.generic_action.v0,'2hr Skin Assessment']/items[at0030]/value/value as ulcers_2hskin_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[openEHR-EHR-CLUSTER.generic_action.v0,'2hr Position Change']/items[at0030]/value/value as ulcers_2hpostion_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Specific Matress']/items[at0030]/value/value as ulcers_matress_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Off load Heels']/items[at0030]/value/value as ulcers_heels_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pressure Ulcers']/items[openEHR-EHR-CLUSTER.generic_action.v0,'High Risk Care Plan']/items[at0030]/value/value as ulcers_hrplan_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[at0009,'Mobility Aids']/items[at0012]/value/value as moving_aids_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[at0009,'Techniques and Equipment']/items[at0012]/value/value as moving_equip_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[at0009,'Previous Fall']/items[at0012]/value/value as moving_fall_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[at0009,'Cognitive Ability']/items[at0012]/value/value as moving_cognition_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Medication Review']/items[at0030]/value/value as moving_medication_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Senior Review']/items[at0030]/value/value as moving_senior_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Identify and Communicate']/items[at0030]/value/value as moving_identity_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Moving and Handling Assessment']/items[at0030]/value/value as moving_assessment_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Equipment Provision']/items[at0030]/value/value as moving_provision_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Supervision Assessment']/items[at0030]/value/value as moving_supervision_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Moving and Handling']/items[openEHR-EHR-CLUSTER.generic_action.v0,'BP Lying and Standing Observation']/items[at0030]/value/value as moving_lyingbp_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition']/items[at0009,'Nil By Mouth']/items[at0012]/value/value as nutrition_nil_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition']/items[at0009,'Safe to Swallow']/items[at0012]/value/value as nutrition_safe_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition']/items[at0009,'Special Diet or Fluids']/items[at0012]/value/value as nutrition_diet_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition']/items[openEHR-EHR-CLUSTER.generic_action.v0,'IV Infusion']/items[at0030]/value/value as nutrition_iv_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Swallow Screen and Referral']/items[at0030]/value/value as nutrition_swallow_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Document Dietary Requirements']/items[at0030]/value/value as nutrition_dietary_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Discharge']/items[at0009,'Barriers to Discharge']/items[at0012]/value/value as discharge_barriers_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Discharge']/items[openEHR-EHR-CLUSTER.generic_action.v0,'JETT Referral']/items[at0030]/value/value as discharge_JETT_comment, \" +\r\n\t\"i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Discharge']/items[openEHR-EHR-CLUSTER.generic_action.v0,'Therapy Referral']/items[at0030]/value/value as discharge_therapy_comment \" +\r\n\t\"FROM EHR e \" +\r\n\t\t\"CONTAINS COMPOSITION c \" +\r\n\t\t\"CONTAINS EVALUATION i[openEHR-EHR-EVALUATION.generic_assessment_collection.v0] \" +\r\n\t\t\"WHERE c/name/value = 'High Impact Risk Assessment' \" +\r\n\t\t\"AND e/ehr_id/value = '<ehrid>' \" +\r\n\t\t\"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\"OFFSET 0 LIMIT 1\";\r\n\r\nvar aboutAQL = \"SELECT c/context/start_time/value as about_completed, \" +\r\n\t\"i/data[at0001]/items[at0005]/value/value as assessment_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Communication']/items[at0009]/items[at0012]/value/value) as com_findings_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Communication']/items[at0015]/items[at0045]/value/value) as com_actions_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Personal Hygiene']/items[at0009]/items[at0012]/value/value) as hyg_findings_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Personal Hygiene']/items[at0015]/items[at0045]/value/value) as hyg_actions_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition and Hydration']/items[at0009]/items[at0012]/value/value) as nut_findings_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Nutrition and Hydration']/items[at0015]/items[at0045]/value/value) as nut_actions_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Sleep and Rest']/items[at0009]/items[at0012]/value/value) as sleep_findings_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Sleep and Rest']/items[at0015]/items[at0045]/value/value) as sleep_actions_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Elimination']/items[at0009]/items[at0012]/value/value) as elimination_findings_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Elimination']/items[at0015]/items[at0045]/value/value) as eliminations_actions_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pain']/items[at0009]/items[at0012]/value/value) as pain_findings_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Pain']/items[at0015]/items[at0045]/value/value) as pain_actions_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Breathing and Circulation']/items[at0009]/items[at0012]/value/value) as breathing_findings_comment, \" + \r\n\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.generic_assessment.v0,'Breathing and Circulation']/items[at0015]/items[at0045]/value/value) as breathing_actions_comment \" +\r\n\t\t\"FROM EHR e \" + \r\n\t\t\"CONTAINS COMPOSITION c \" +\r\n\t\t\"CONTAINS EVALUATION i[openEHR-EHR-EVALUATION.generic_assessment_collection.v0] \" +\r\n\t\t\"WHERE c/name/value = 'About Me' \" +\r\n\t\t\"AND e/ehr_id/value = '<ehrid>' \" +\r\n\t\t\"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\"OFFSET 0 LIMIT 1\";\r\n\r\nvar bodyAQL = \"SELECT c/context/start_time/value as body_completed, \" +\r\n\t\t\"i/data[at0001]/items[at0005]/value/value as assessment_comment, \" +\r\n\t\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.body_part_observation.v0]/items[at0009]/items[at0002]/value/value) as body_part_comment, \" +\r\n\t\t\"SQUASH(i/data[at0001]/items[at0006]/items[openEHR-EHR-CLUSTER.body_part_observation.v0]/items[at0009]/items[at0003]/value/value) as body_part \" +\r\n\t\t\"FROM EHR e \" + \r\n\t\t\"CONTAINS COMPOSITION c \" +\r\n\t\t\"CONTAINS EVALUATION i[openEHR-EHR-EVALUATION.generic_assessment_collection.v0] \" +\r\n\t\t\"WHERE c/name/value = 'Body Map' \" +\r\n\t\t\"AND e/ehr_id/value = '<ehrid>' \" +\r\n\t\t\"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\"OFFSET 0 LIMIT 1\";\r\n\t\t\r\nvar waterlowAQL = \"SELECT i/data[at0001]/events[at0002]/data[at0003]/items[at0015]/value/value as waterlow_risk, \" +\r\n\t\t\t\t\t\t   \"i/data[at0001]/events[at0002]/data[at0003]/items[at0014]/value/magnitude as waterlow_score, \" +\r\n\t\t\t\t\t\t   \"c/context/start_time/value as waterlow_completed, \" +\r\n\t\t\t\t\t\t\"SQUASH(i/data[at0001]/events[at0002]/data[at0003]/items[at0019]/value/value) as waterlow_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(d/data[at0002]/events[at0003]/data[at0001]/items[at0024]/value/value) as weight_any_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(d/data[at0002]/events[at0003]/data[at0001]/items[at0024]/value/value) as weight_reporting_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(v/data[at0001]/events[at0002]/data[at0003]/items[at0018]/value/value) as height_any_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(v/protocol[at0007]/items[openEHR-EHR-CLUSTER.reporting_status.v0]/items[at0002]/value/value) as height_reporting_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(x/data[at0001]/events[at0002]/data[at0003]/items[at0012]/value/value) as bodymass_any_comment \" +\r\n\t\t\t\t\t\"FROM EHR e \" +\r\n\t\t\t\t\t\"CONTAINS COMPOSITION c \" +\r\n\t\t\t\t\t\"CONTAINS (OBSERVATION i[openEHR-EHR-OBSERVATION.waterlow_score.v0] and OBSERVATION d[openEHR-EHR-OBSERVATION.body_weight.v2] and OBSERVATION v[openEHR-EHR-OBSERVATION.height.v2] and OBSERVATION x[openEHR-EHR-OBSERVATION.body_mass_index.v2]) \" +\r\n\t\t\t\t\t\"WHERE e/ehr_id/value = '<ehrid>' \" +\r\n\t\t            \"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\t\t\t\"OFFSET 0 LIMIT 1\";\r\n\t\t\t\t\t\r\nvar diabetesAQL = \"SELECT q/data[at0001]/items[at0028]/items[at0029]/value/value as diabetic_diabetes, \" +\r\n\t\t\t\t\t\t\"q/data[at0001]/items[at0031]/value/value as diabetic_referral, \" +\r\n\t\t\t\t\t\t\"c/context/start_time/value as diabetic_completed, \" +\r\n\t\t\t\t\t\t\"q/data[at0001]/items[at0027]/items[at0023]/value/value as additional_comment \" +\r\n\t\t\t\t\t\"FROM EHR e \" +\r\n\t\t\t\t\t\"CONTAINS COMPOSITION c \" +\r\n\t\t\t\t\t\"CONTAINS EVALUATION q[openEHR-EHR-EVALUATION.paitent_diabetes_foot_screening.v0] \" +\r\n\t\t\t\t\t\"WHERE e/ehr_id/value = '<ehrid>' \" +\r\n\t\t                        \"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\t\t\t\"OFFSET 0 LIMIT 1\";\r\n\t\t\t\t\t\r\nvar ccpAQL = \"SELECT a/data[at0001]/events[at0002]/data[at0003]/items[at0004]/items[at0005]/value/value as core_risk, \" +\r\n\t\t\t\t\"c/context/start_time/value as core_completed, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0004]/items[at0005]/value/value as core_risk, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0018]/items[at0023]/value/value as skin_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0024]/items[at0031]/value/value as surface_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0049]/items[at0054]/value/value as keep_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0055]/items[at0076]/value/value as incontinence_treatment_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0055]/items[at0057]/value/value as incontinence_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0062]/items[at0087]/value/value as nutrition_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0068]/items[at0082]/items[at0081]/value/value as patient_leaflet_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0099]/items[at0098]/value/value as patient_comment, \" +\r\n\t\t\t\t\"a/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0099]/items[at0098]/value/value as care_given_comment \" +\r\n\t\t\t\"FROM EHR e \" +\r\n\t\t\t\"CONTAINS COMPOSITION c \" +\r\n\t\t\t\"CONTAINS OBSERVATION a[openEHR-EHR-OBSERVATION.ulcer_prevention_management.v0]  \" +\r\n\t\t\t\"WHERE e/ehr_id/value = '<ehrid>' \" +\r\n\t\t        \"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\t\"OFFSET 0 LIMIT 1\";\r\n\t\t\t\r\nvar mustAQL = \"SELECT q/data[at0001]/events[at0002]/data[at0003]/items[at0016]/value/value as must_risk, \" +\r\n\t\t\t\t\t   \"q/data[at0001]/events[at0002]/data[at0003]/items[at0015]/value/magnitude as must_score, \" +\r\n\t\t\t\t\t   \"c/context/start_time/value as must_completed, \" +\r\n\t\t\t\t\t   \"SQUASH(w/protocol[at0015]/items[openEHR-EHR-CLUSTER.reporting_status.v0]/items[at0002]/value/value) as weight_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(h/protocol[at0007]/items[openEHR-EHR-CLUSTER.reporting_status.v0]/items[at0002]/value/value) as height_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(m/data[at0001]/items[at0003]/value/value) as mangement_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(s/data[at0001]/events[at0002]/data[at0003]/items[at0009]/value/value) as segment_comment, \" +\r\n\t\t\t\t\t\t\"SQUASH(a/items[openEHR-EHR-OBSERVATION.body_weight.v2,'Body weight 3 to 6 months ago']/protocol[at0015]/items[openEHR-EHR-CLUSTER.reporting_status.v0]/items[at0002]/value/value) as weight_loss_comment \" +\r\n\t\t\t\t\"FROM EHR e \" +\r\n\t\t\t\t\"CONTAINS COMPOSITION c  \" +\r\n\t\t\t\t\"CONTAINS (OBSERVATION q[openEHR-EHR-OBSERVATION.must.v0] and EVALUATION m[openEHR-EHR-EVALUATION.management_guidelines.v0] or (OBSERVATION w[openEHR-EHR-OBSERVATION.body_weight.v2] or OBSERVATION h[openEHR-EHR-OBSERVATION.height.v2] or OBSERVATION s[openEHR-EHR-OBSERVATION.body_segment_length.v0] or SECTION a[openEHR-EHR-SECTION.adhoc.v1,'Weight loss comparison'])) \" +\r\n\t\t\t\t\"WHERE e/ehr_id/value = '<ehrid>' \" +\r\n\t\t                \"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\t\t\"OFFSET 0 LIMIT 1\";\r\n\t\t\t\t\r\nvar fallsAQL = \"SELECT k/data[at0002]/items[at0014]/value/value as falls_risk, \" +\r\n\t\t\t\t\t   \"c/context/start_time/value as falls_completed, \" +\r\n\t\t\t\t\"k/data[at0002]/items[at0013]/value/value as falls_risk_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0012]/items[at0005]/value/value) as check_lying_bp_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0013]/items[at0015]/value/value) as check_elimination_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0017]/items[at0019]/value/value) as check_fear_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0021]/items[at0023]/value/value) as check_sensory_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0102]/items[at0104]/value/value) as check_update_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0107]/items[at0109]/value/value) as check_falls_history_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0025]/items[at0027]/value/value) as check_collateral_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0033]/items[at0035]/value/value) as check_briefing_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0097]/items[at0099]/value/value) as check_high_rails_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0029]/items[at0031]/value/value) as check_bed_rails_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0037]/items[at0039]/value/value) as check_high_bed_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0041]/items[at0043]/value/value) as check_crash_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0045]/items[at0047]/value/value) as check_medication_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0049]/items[at0051]/value/value) as check_visible_bed_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0053]/items[at0055]/value/value) as check_regular_check_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0057]/items[at0059]/value/value) as check_vision_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0061]/items[at0063]/value/value) as check_supervision_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0065]/items[at0067]/value/value) as check_hourly_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0069]/items[at0071]/value/value) as check_footwear_comment, \" + \r\n\"SQUASH(k/data[at0001]/events[at0002]/data[at0003]/items[at0073]/items[at0075]/value/value) as check_walking_comment, \" + \r\n\"SQUASH(k/protocol[at0007]/items[openEHR-EHR-CLUSTER.reporting_status.v0]/items[at0002]/value/value) as check_reporting_comment, \" + \r\n\"SQUASH(b/items[openEHR-EHR-SECTION.adhoc.v1,'Vital signs']/items[openEHR-EHR-SECTION.adhoc.v1,'Blood pressure when lying for 5 mins']/items[openEHR-EHR-OBSERVATION.blood_pressure.v2]/data[at0001]/events[at0006]/data[at0003]/items[at0033]/value/value) as bp_any_5mins_comment, \" + \r\n\"SQUASH(b/items[openEHR-EHR-SECTION.adhoc.v1,'Vital signs']/items[openEHR-EHR-SECTION.adhoc.v1,'Blood pressure when lying for 5 mins']/items[openEHR-EHR-OBSERVATION.blood_pressure.v2]/protocol[at0011]/items[openEHR-EHR-CLUSTER.device.v1]/items[at0008]/value/value) as bp_md_5mins_comment, \" + \r\n\"SQUASH(b/items[openEHR-EHR-SECTION.adhoc.v1,'Vital signs']/items[openEHR-EHR-SECTION.adhoc.v1,'Blood pressure when standing for 1 min']/items[openEHR-EHR-OBSERVATION.blood_pressure.v2]/data[at0001]/events[at0006]/data[at0003]/items[at0033]/value/value) as bp_any_1min_comment, \" + \r\n\"SQUASH(b/items[openEHR-EHR-SECTION.adhoc.v1,'Vital signs']/items[openEHR-EHR-SECTION.adhoc.v1,'Blood pressure when standing for 1 min']/items[openEHR-EHR-OBSERVATION.blood_pressure.v2]/protocol[at0011]/items[openEHR-EHR-CLUSTER.device.v1]/items[at0008]/value/value) as bp_md_1min_comment, \" + \r\n\"SQUASH(b/items[openEHR-EHR-SECTION.adhoc.v1,'Vital signs']/items[openEHR-EHR-SECTION.adhoc.v1,'Blood pressure when standing for 3 mins']/items[openEHR-EHR-OBSERVATION.blood_pressure.v2]/data[at0001]/events[at0006]/data[at0003]/items[at0033]/value/value) as bp_any_3min_comment, \" + \r\n\"SQUASH(b/items[openEHR-EHR-SECTION.adhoc.v1,'Vital signs']/items[openEHR-EHR-SECTION.adhoc.v1,'Blood pressure when standing for 3 mins']/items[openEHR-EHR-OBSERVATION.blood_pressure.v2]/protocol[at0011]/items[openEHR-EHR-CLUSTER.device.v1]/items[at0008]/value/value) as bp_md_3min_comment \" +\r\n\"FROM EHR e \" +\r\n\"CONTAINS COMPOSITION c \" +\r\n\"CONTAINS (EVALUATION k[openEHR-EHR-EVALUATION.patient_falls_risk.v0] OR SECTION b[openEHR-EHR-SECTION.adhoc.v1,'Patient measurements']) \" +\r\n\t\t\t\t\"WHERE e/ehr_id/value = '<ehrid>' \" +\r\n\t\t                \"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\t\t\"OFFSET 0 LIMIT 1\";\r\n\t\t\t\t\r\nvar movingAQL = \"SELECT c/context/start_time/value as moving_completed, \" +\r\n\t\t\"f/data[at0001]/items[at0015]/value/value as moving_risk, \" +\r\n\t\t\"f/data[at0001]/items[at0014]/value/value as moving_independent, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Moving Up or Down the bed']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_moving_up_down, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Rolling or Turning In Bed']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_rolling, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Sitting Up In Bed']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_sitting_up, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Sitting In Bed/Side Lying to/from Edge Sitting']/items[at0049]/items[at0028]/items[at0043]/name/value) as \t\tequip_sitting, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Bed to Bed']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_bed_to_bed, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Sit to/from Stand (Chair, Commode, Or Toilet)']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_sit_stand, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Seated To Seated Transfer (Chair, Commode, or Toilet)']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_seat_to_seat, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Walking']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_walk, \" +\r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Emergency Handling']/items[at0049]/items[at0028]/items[at0043]/name/value) as equip_emergency, \" +\r\n\t\t\"f/data[at0001]/items[at0003,'Assessment Comment']/value/value as assessment_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0079]/value/value as mobility_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0082]/value/value as communication_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0083]/value/value as visual_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0080]/value/value as confusion_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0081]/value/value as surgery_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0085]/value/value as medication_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0086]/value/value as equipment_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Moving Up or Down the bed']/items[at0036]/value/value as plan_updown_bed_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Rolling or Turning In Bed']/items[at0036]/value/value as plan_rolling_bed_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Sitting Up In Bed']/items[at0036]/value/value as plan_sitting_bed_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Sitting In Bed/Side Lying to/from Edge Sitting']/items[at0036]/value/value as plan_side_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Bed to Bed']/items[at0036]/value/value as plan_bed_to_bed_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Sit to/from Stand (Chair, Commode, Or Toilet)']/items[at0036]/value/value as plan_sit_to_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Seated To Seated Transfer (Chair, Commode, or Toilet)']/items[at0036]/value/value as plan_seated_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Walking']/items[at0036]/value/value as plan_walking_comment, \" + \r\n\t\t\"f/data[at0001]/items[at0019]/items[at0020,'Moving and Handling Task - Emergency Handling']/items[at0036]/value/value as plan_emergency_comment, \" + \r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0050]/items[at0040,'Mobile Hoist System']/items[openEHR-EHR-CLUSTER.device.v1]/items[at0008]/value/value) as plan_equip_mobilehoist_comment, \" + \r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0050]/items[at0040,'Sit To Stand Hoist System']/items[openEHR-EHR-CLUSTER.device.v1]/items[at0008]/value/value) as plan_equip_sitstand_comment, \" + \r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0050]/items[at0040,'Sling']/items[openEHR-EHR-CLUSTER.device.v1]/items[at0008]/value/value) as plan_equip_sling_comment, \" + \r\n\t\t\"SQUASH(f/data[at0001]/items[at0019]/items[at0050]/items[at0040,'Bed']/items[openEHR-EHR-CLUSTER.device.v1]/items[at0008]/value/value) as plan_equip_bed_comment, \" + \r\n\t\t\"w/data[at0002]/events[at0003]/data[at0001]/items[at0024]/value/value as weight_any_comment, \" + \r\n\t\t\"w/protocol[at0015]/items[openEHR-EHR-CLUSTER.reporting_status.v0]/items[at0002]/value/value as weight_reporting_comment, \" + \r\n\t\t\"h/data[at0001]/events[at0002]/data[at0003]/items[at0018]/value/value as height_any_comment, \" + \r\n\t\t\"h/data[at0001]/events[at0021]/data[at0003]/items[at0018]/value/value as height_birth_comment, \" + \r\n\t\t\"h/protocol[at0007]/items[openEHR-EHR-CLUSTER.reporting_status.v0]/items[at0002]/value/value as height_reporting_comment \" +\r\n\t\t\"FROM EHR e \" +\r\n\t\t\"CONTAINS COMPOSITION c[openEHR-EHR-COMPOSITION.encounter.v1] \" +\r\n\t\t\"CONTAINS (EVALUATION f[openEHR-EHR-EVALUATION.patient_handling.v0] OR OBSERVATION w[openEHR-EHR-OBSERVATION.body_weight.v2] OR OBSERVATION h[openEHR-EHR-OBSERVATION.height.v2]) \" +\r\n\t\t\"WHERE c/name/value = 'Moving and Handling Assessment and Care Plan'\" +\r\n\t\t\"AND e/ehr_id/value = '<ehrid>'\" +\r\n\t\t\"ORDER BY c/context/start_time/value DESC \" +\r\n\t\t\"LIMIT 1;\";\r\n\r\nvar railsAQL = \"SELECT u/data[at0001]/events[at0002]/data[at0003]/items[at0009]/items[at0019]/value/value as rails_guidance, \" +\r\n\t\t\t\t\t   \"c/context/start_time/value as rails_completed \" +\r\n\t\t\t\t\"FROM EHR e \" +\r\n\t\t\t\t\"CONTAINS COMPOSITION c \" +\r\n\t\t\t\t\"CONTAINS OBSERVATION u[openEHR-EHR-OBSERVATION.bed_rails_low_bed_risk_assessment.v0]  \" +\r\n\t\t\t\t\"WHERE e/ehr_id/value = '<ehrid>' \" +\r\n\t\t                \"ORDER BY c/context/start_time/value DESC  \" +\r\n\t\t\t\t\"OFFSET 0 LIMIT 1\";\r\n\r\nfunction getValueOrEmpty(val) {\r\n    if(val != null) {\r\n        return val;\r\n    }\r\n    return '';\r\n}\r\n\r\n\r\nfunction processHighRisk(ehrid, baseQuery, results) {\r\n\tvar query = highAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.high_risk = {\r\n\t\t\tcompleted: form.high_completed,\r\n\t\t\tcomments: {\r\n\t\t\t\tassessment: getValueOrEmpty(form.assessment_comment),\r\n\t\t\t\tinfection_control: {\r\n\t\t\t\t\tinfectious: getValueOrEmpty(form.infection_infectious_comment),\r\n\t\t\t\t\tlived_abroad: getValueOrEmpty(form.infection_abroad_comment),\r\n\t\t\t\t\thospital_outside: getValueOrEmpty(form.infection_hospital_out_comment),\r\n\t\t\t\t\thospital_within: getValueOrEmpty(form.infection_hospital_in_comment),\r\n\t\t\t\t\ttravelled_outside: getValueOrEmpty(form.infection_travelled_comment),\r\n\t\t\t\t\thousehold_cpe: getValueOrEmpty(form.infection_householdcpe_comment),\r\n\t\t\t\t\tcolonised_cpe: getValueOrEmpty(form.infection_colonisedcpe_comment),\r\n\t\t\t\t\tmrsa_screening: getValueOrEmpty(form.infection_mrsa_comment),\r\n\t\t\t\t\tpatient_isolation: getValueOrEmpty(form.infection_isolation_comment),\r\n\t\t\t\t\tspecimen_collection: getValueOrEmpty(form.infection_specimen_comment),\r\n\t\t\t\t\trectal_swab: getValueOrEmpty(form.infection_rectal_comment),\r\n\t\t\t\t\tmrsa_screening2: getValueOrEmpty(form.infection_mrsa2_comment),\r\n\t\t\t\t},\r\n\t\t\t\tpressure_ulcers: {\r\n\t\t\t\t\texisting_ulcer: getValueOrEmpty(form.ulcers_existing_comment),\r\n\t\t\t\t\tparaglegia: getValueOrEmpty(form.ulcers_paraplegia_comment),\r\n\t\t\t\t\tperipheral_neuropathy: getValueOrEmpty(form.ulcers_neuropathy_comment),\r\n\t\t\t\t\tmobility: getValueOrEmpty(form.ulcers_mobility_comment),\r\n\t\t\t\t\tskin_assessment: getValueOrEmpty(form.ulcers_2hskin_comment),\r\n\t\t\t\t\tposition: getValueOrEmpty(form.ulcers_2hposition_comment),\r\n\t\t\t\t\tspecific_matress: getValueOrEmpty(form.ulcers_matress_comment),\r\n\t\t\t\t\toff_load_heels: getValueOrEmpty(form.ulcers_heels_comment),\r\n\t\t\t\t\thigh_risk_care_plan: getValueOrEmpty(form.ulcers_hrplan_comment)\r\n\t\t\t\t},\r\n\t\t\t\tmoving_and_handling: {\r\n\t\t\t\t\tmobility_aids: getValueOrEmpty(form.moving_aids_comment),\r\n\t\t\t\t\ttechniques_and_equipment: getValueOrEmpty(form.moving_equip_comment),\r\n\t\t\t\t\tprevious_fall: getValueOrEmpty(form.moving_fall_comment),\r\n\t\t\t\t\tcognitive_ability: getValueOrEmpty(form.moving_cognition_comment),\r\n\t\t\t\t\tmedication_review: getValueOrEmpty(form.moving_medication_comment),\r\n\t\t\t\t\tsenior_review: getValueOrEmpty(form.moving_senior_comment),\r\n\t\t\t\t\tidentify_and_communicate: getValueOrEmpty(form.moving_identity_comment),\r\n\t\t\t\t\tmoving_and_handling_assessment: getValueOrEmpty(form.moving_assessment_comment),\r\n\t\t\t\t\tequipment_provision: getValueOrEmpty(form.moving_provision_comment),\r\n\t\t\t\t\tsupervision_assessment: getValueOrEmpty(form.moving_supervision_comment),\r\n\t\t\t\t\tbp_lying_and_standing: getValueOrEmpty(form.moving_lyingbp_comment)\r\n\t\t\t\t},\r\n\t\t\t\tnutrition: {\r\n\t\t\t\t\tnil_by_mouth: getValueOrEmpty(form.nutrition_nil_comment),\r\n\t\t\t\t\tsafe_to_swallow: getValueOrEmpty(form.nutrition_safe_comment),\r\n\t\t\t\t\tspecial_diet: getValueOrEmpty(form.nutrition_diet_comment),\r\n\t\t\t\t\tiv_infusion: getValueOrEmpty(form.nutrition_iv_comment),\r\n\t\t\t\t\tswallow_screen: getValueOrEmpty(form.nutrition_swallow_comment),\r\n\t\t\t\t\tdocument_dietary_requirements: getValueOrEmpty(form.nutrition_dietary_comment)\r\n\t\t\t\t},\r\n\t\t\t\tdischarge: {\r\n\t\t\t\t\tbarriers_to_discharge: getValueOrEmpty(form.discharge_barriers_comment),\r\n\t\t\t\t\tjett_referral: getValueOrEmpty(form.discharge_JETT_comment),\r\n\t\t\t\t\ttherapy_referral: getValueOrEmpty(form.discharge_therapy_comment)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\nfunction processAboutMe(ehrid, baseQuery, results) {\r\n\tvar query = aboutAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.about_me = {\r\n\t\t\tcompleted: form.about_completed,\r\n\t\t\tcomments: {\r\n\t\t\t\tassessment: getValueOrEmpty(form.assessment_comment),\r\n\t\t\t\tcommunication: {\r\n\t\t\t\t\tfindings: form.com_findings_comment,\r\n\t\t\t\t\tactions: form.com_actions_comment\r\n\t\t\t\t},\r\n\t\t\t\tpersonal_hygiene: {\r\n\t\t\t\t\tfindings: form.hyg_findings_comment,\r\n\t\t\t\t\tactions: form.hyg_actions_comment\r\n\t\t\t\t},\r\n\t\t\t\tnutrition_and_hydration: {\r\n\t\t\t\t\tfindings: form.nut_findings_comment,\r\n\t\t\t\t\tactions: form.nut_actions_comment\r\n\t\t\t\t},\r\n\t\t\t\tsleep_and_rest: {\r\n\t\t\t\t\tfindings: form.sleep_findings_comment,\r\n\t\t\t\t\tactions: form.sleep_actions_comment\r\n\t\t\t\t},\r\n\t\t\t\telimination: {\r\n\t\t\t\t\tfindings: form.elimination_findings_comment,\r\n\t\t\t\t\tactions: form.eliminations_actions_comment\r\n\t\t\t\t},\r\n\t\t\t\tpain: {\r\n\t\t\t\t\tfindings: form.pain_findings_comment,\r\n\t\t\t\t\tactions: form.pain_actions_comment\r\n\t\t\t\t},\r\n\t\t\t\tbreathing_and_circulation: {\r\n\t\t\t\t\tfindings: form.breathing_findings_comment,\r\n\t\t\t\t\tactions: form.breathing_actions_comment\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {});\r\n\treturn results;\r\n}\r\n\r\nfunction processBodyMap(ehrid, baseQuery, results) {\r\n\tvar query = bodyAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.body_map = {\r\n\t\t\tcompleted: form.body_completed,\r\n\t\t\tcomments: {\r\n\t\t\t\tassessment: getValueOrEmpty(form.assessment_comment),\r\n\t\t\t\tbody_parts: form.body_part,\r\n\t\t\t\tbody_parts_comment: form.body_part_comment\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\nfunction processWaterlow(ehrid, baseQuery, results) {\r\n\tvar query = waterlowAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.waterlow = {\r\n\t\t\tcompleted: form.waterlow_completed,\r\n\t\t\trisk: getValueOrEmpty(form.waterlow_risk),\r\n\t\t\tscore: getValueOrEmpty(form.waterlow_score),\r\n\t\t\tcomments: {\r\n\t\t\t\twaterlow: form.waterlow_comment,\r\n\t\t\t\tweight: {\r\n\t\t\t\t\tany_event: form.weight_any_comment,\r\n\t\t\t\t\treporting: form.weight_reporting_comment\r\n\t\t\t\t},\r\n\t\t\t\theight: {\r\n\t\t\t\t\tany_event: form.height_any_comment,\r\n\t\t\t\t\treporting: form.height_reporting_comment\r\n\t\t\t\t},\r\n\t\t\t\tbodymass: form.bodymass_any_comment\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\nfunction processDiabetes(ehrid, baseQuery, results) {\r\n\tvar query = diabetesAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.diabetic_foot = {\r\n\t\t\tcompleted: form.diabetic_completed,\r\n\t\t\thas_diabetes: getValueOrEmpty(form.diabetic_diabetes),\r\n\t\t\treferral: getValueOrEmpty(form.diabetic_referral),\r\n\t\t\tcomments: {\r\n\t\t\t\tadditional: getValueOrEmpty(form.additional_comment)\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\nfunction processCCP(ehrid, baseQuery, results) {\r\n\tvar query = ccpAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.core_care_plan = {\r\n\t\t\tcompleted: form.core_completed,\r\n\t\t\trisk: getValueOrEmpty(form.core_risk),\r\n\t\t\tcomments: {\r\n\t\t\t\tASSESS: {\r\n\t\t\t\t\ts_skin: getValueOrEmpty(form.skin_comment),\r\n\t\t\t\t\ts_surface: getValueOrEmpty(form.surface_comment),\r\n\t\t\t\t\tk_keep_moving: getValueOrEmpty(form.keep_comment),\r\n\t\t\t\t\ti_incontinence: {\r\n\t\t\t\t\t\ttreatment_line: getValueOrEmpty(form.incontinence_treatment_comment),\r\n\t\t\t\t\t\tcomment: getValueOrEmpty(form.incontinence_comment),\r\n\t\t\t\t\t},\r\n\t\t\t\t\tn_nutrition: getValueOrEmpty(form.nutrition_comment),\r\n\t\t\t\t\tg_patient_information: {\r\n\t\t\t\t\t\tpatient_leaflet: getValueOrEmpty(form.patient_leaflet_comment),\r\n\t\t\t\t\t\tcomment: getValueOrEmpty(form.patient_comment)\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcare_given: getValueOrEmpty(form.care_given_comment)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\nfunction processMUST(ehrid, baseQuery, results) {\r\n\tvar query = mustAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.must = {\r\n\t\t\tcompleted: form.must_completed,\r\n\t\t\trisk: getValueOrEmpty(form.must_risk),\r\n\t\t\tscore: getValueOrEmpty(form.must_score),\r\n\t\t\tcomment: {\r\n\t\t\t\tweight: form.weight_comment,\r\n\t\t\t\theight: form.height_comment,\r\n\t\t\t\tmanagement_guidelines: form.mangement_comment,\r\n\t\t\t\tsegment_comment: form.segment_comment,\r\n\t\t\t\tweight_loss: form.weight_loss_comment\r\n\t\t\t}\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\nfunction processFalls(ehrid, baseQuery, results) {\r\n\tvar query = fallsAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.falls = {\r\n\t\t\tcompleted: form.falls_completed,\r\n\t\t\trisk: getValueOrEmpty(form.falls_risk)\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\t\r\n\r\nfunction processMovingEquipment(form) {\r\n\tvar result = 'None';\r\n\t\r\n\tvar equipArrays = [form.equip_bed_to_bed, \r\n\t\t\t\t\t\tform.equip_emergency,\r\n\t\t\t\t\t\tform.equip_moving_up_down,\r\n\t\t\t\t\t\tform.equip_rolling,\r\n\t\t\t\t\t\tform.equip_seat_to_seat,\r\n\t\t\t\t\t\tform.equip_sit_stand,\r\n\t\t\t\t\t\tform.equip_sitting,\r\n\t\t\t\t\t\tform.equip_sitting_up,\r\n\t\t\t\t\t\tform.equip_walk];\r\n\t\r\n\tfor(var i = 0; i < equipArrays.length; i++) {\r\n\t\tif(!isEmptyOrNoneRequired(equipArrays[i])) {\r\n\t\t\treturn 'Yes';\r\n\t\t}\r\n\t}\r\n\t\t\r\n\treturn result;\r\n}\r\n\r\nfunction isEmptyOrNoneRequired(equipment) {\r\n\tif(!equipment || equipment.length == 0) {\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\tfor(var i = 0; i < equipment.length; i++) {\r\n\t\tif(!equipment[i].toLowerCase().startsWith('none')) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t\r\n\treturn true;\r\n}\r\n\r\nfunction processMoving(ehrid, baseQuery, results) {\r\n\tvar query = movingAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.moving_and_handling = {\r\n\t\t\tcompleted: form.moving_completed,\r\n\t\t\tequipment: processMovingEquipment(form),\r\n\t\t\tequipment_breakdown: {\r\n\t\t\t\tbed_to_bed: form.equip_bed_to_bed, \r\n\t\t\t\temergency: form.equip_emergency,\r\n\t\t\t\tmoving_up: form.equip_moving_up_down,\r\n\t\t\t\trolling: form.equip_rolling,\r\n\t\t\t\tseat_to_seat: form.equip_seat_to_seat,\r\n\t\t\t\tsit_stand: form.equip_sit_stand,\r\n\t\t\t\tsitting: form.equip_sitting,\r\n\t\t\t\tsitting_up: form.equip_sitting_up,\r\n\t\t\t\twalk: form.equip_walk\r\n\t\t\t},\r\n\t\t\tindependent: getValueOrEmpty(form.moving_independent),\r\n\t\t\trisk: getValueOrEmpty(form.moving_risk)\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\nfunction processRails(ehrid, baseQuery, results) {\r\n\tvar query = railsAQL;\r\n\tbaseQuery.aql = query.replace(ehrIDReplace, ehrid);\r\n\tbaseQuery.callback = function (out, form) {\r\n\t\tresults.rails = {\r\n\t\t\tcompleted: form.rails_completed,\r\n\t\t\tguidance: getValueOrEmpty(form.rails_guidance)\r\n\t\t};\r\n\t};\r\n\t\r\n\tEhr.allhash({forms: Ehr.query(baseQuery)}, function (res) {\t});\r\n\treturn results;\r\n}\r\n\r\n\r\nfunction compute(ctx, src) {\r\n\tvar ehrid = ctx.vars.ehrId;\r\n\tif(!ehrid) {\r\n\t\tthrow new Error('No EHRID supplied');\r\n\t}\r\n\t\r\n\ttry {\r\n\t\tvar results = {};\r\n\t\tvar baseQuery = {\r\n\t\t\taql: '',\r\n\t\t\tparams: ctx.vars,\r\n\t\t\tinitvalue: [],\r\n\t\t\tcallback: null\r\n\t\t};\r\n\t\t\r\n\t\tvar procs = [processHighRisk, processAboutMe, processBodyMap,\r\n\t\t\t\t\t\tprocessWaterlow, processDiabetes, processCCP, \r\n\t\t\t\t\t\tprocessMUST, processFalls, processMoving,\r\n\t\t\t\t\t\tprocessRails];\r\n\t\t\t\t\t\t\r\n\t\tfor(var i = 0; i < procs.length; i++) {\r\n\t\t\tresults = procs[i](ehrid, baseQuery, results);\r\n\t\t}\r\n\t\t\r\n\t\treturn results;\r\n\t} catch(ex) {\r\n\t\tthrow new Error('exceptiion!: ' + ex.message + ex.stacktrace)\r\n\t}\r\n}"}]}